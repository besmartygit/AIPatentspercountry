
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Patents per million</title>
  <!-- Highcharts core + data + exporting modules -->
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/offline-exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 20px; }
    #container { width: 100%; height: 520px; }
    .controls { margin: 12px 0; }
    button { padding: 8px 12px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Patents per Million (latest year per country)</h2>
  <div class="controls">
    <button id="savePng">ðŸ’¾ Save PNG</button>
  </div>
  <div id="container"></div>

  <script>
    // Embedded data from Python
    const categories = ["USA", "KOR", "GBR", "AUS", "NLD", "CHE", "JPN", "DEU", "FRA", "ESP"];
    const values = [17.99, 16.69, 11.06, 7.54, 5.64, 5.19, 3.93, 3.31, 1.81, 0.41];
    const years = ["2022", "2022", "2022", "2022", "2022", "2022", "2022", "2022", "2022", "2022"];

    // If countries have different latest years, show a note
    let subtitle = '';
    const uniqueYears = Array.from(new Set(years.filter(y => !!y)));
    subtitle = uniqueYears.length === 1
      ? 'Latest year: ' + uniqueYears[0]
      : 'Latest year per country: ' + uniqueYears.join(', ');

    const chart = Highcharts.chart('container', {
      chart: { type: 'column' },
      title: { text: 'Patents per Million (latest year)' },
      subtitle: { text: subtitle },
      xAxis: {
        categories: categories,
        title: { text: 'Country' },
        tickInterval: 1
      },
      yAxis: {
        min: 0,
        title: { text: 'Patents per million people' }
      },
      tooltip: {
        pointFormat: '<b>{point.y:.2f}</b> patents per million'
      },
      plotOptions: {
        series: {
          dataLabels: { enabled: true, format: '{point.y:.2f}' }
        }
      },
      series: [{
        name: 'Patents per million',
        data: values
      }],
      credits: { enabled: false },
      exporting: { enabled: true }  // shows the download menu (PNG/JPEG/PDF/SVG)
    });

    // Programmatic export (Save PNG button)
    document.getElementById('savePng').addEventListener('click', () => {
      if (chart && chart.exportChartLocal) {
        chart.exportChartLocal({
          type: 'image/png',
          filename: 'patents_per_million_latest'
        });
      } else {
        // Fallback: open the built-in menu if local export is unavailable
        alert('Local export not available; use the chart menu (â‰¡) to download.');
      }
    });
  </script>
</body>
</html>
